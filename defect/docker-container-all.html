<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/img/apple-touch-icon.webp"><link rel="icon" type="image/png" href="/images/img/favicon.webp"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#9DC8C8"><meta name="description" content=""><meta name="author" content="Defectink"><meta name="keywords" content=""><title>Docker-å…¨é¢å®¹å™¨åŒ–ï¼ - ğŸ­Defectink</title><link rel="stylesheet" href="https://cdn.defectink.com/static/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.defectink.com/static/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.defectink.com/static/highlight.js/10.0.0/styles/github-gist.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="https://cdn.defectink.com/static/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/xfy.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/xml/atom.xml" title="ğŸ­Defectink" type="application/atom+xml"><link rel="alternate" href="/xml/rss.xml" title="ğŸ­Defectink" type="application/rss+xml"></head><body><header style="height:75vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>ğŸ­Defectink</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/">ğŸ  é¦–é¡µ</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">ğŸ“• ç´¢å¼•</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/categories/">ğŸ åˆ†ç±»</a> <a class="dropdown-item" href="/tags/">ğŸ æ ‡ç­¾</a></div></li><li class="nav-item"><a class="nav-link" href="/archives/">ğŸ“‚ å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/about/">ğŸƒ å…³äº</a></li><li class="nav-item"><a class="nav-link" href="/links/">ğŸ™†â€â™€ï¸ å°ä¼™ä¼´</a></li><li class="nav-item"><a class="nav-link" href="/pgp/">ğŸ” PGP</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(/images/img/post.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Defectink</span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2019-12-19 11:11" pubdate>2019å¹´12æœˆ19æ—¥ ä¸Šåˆ</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 4.6k å­—</span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 65 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Docker-å…¨é¢å®¹å™¨åŒ–ï¼</h1><p class="note note-info">æœ¬æ–‡æœ€åæ°´äºï¼š2020å¹´11æœˆ2æ—¥ å‡Œæ™¨</p><div class="markdown-body" id="post-body"><p>è‡ªä¸Šç¯‡<a href="https://www.defectink.com/defect/docker-build-own-images.html">Docker - æ„å»ºå±äºè‡ªå·±çš„é•œåƒ</a>ä»¥æ¥ï¼Œå‘ç°Dockeréå¸¸çš„æœ‰æ„æ€ã€‚ä¸»è¦æ˜¯éå¸¸çš„æ–¹ä¾¿ï¼Œå¹¶ä¸”åœ¨å¯ä»¥è·¨å¹³å°çš„æƒ…å†µä¸‹éƒ¨ç½²ç¯å¢ƒå¯¹äºä»¥åè¿ç§»ä¹Ÿæ˜¯ä¸€ä»¶æå…¶æœ‰åˆ©çš„äº‹ã€‚ç ”ç©¶äº†Dockerfileçš„ç¼–å†™ä»¥åŠå®è·µã€‚ä¸€äº›åŸºç¡€çš„å®è·µä¹‹åï¼Œå¯¹äºDockerçš„å·¥ä½œæ–¹å¼ä»¥åŠæ“ä½œå‘½ä»¤éƒ½æœ‰äº†ä¸€äº›ç†Ÿæ‚‰ã€‚ä¹Ÿé€æ¸äº†å‘ç°äº†å®ƒçš„ä¸€äº›ä¼˜ç‚¹ã€‚</p><p>ç¿»å¼€è‡ªå·±çš„æ—§æœºå™¨é‡Œçš„å¤šç§ç¯å¢ƒäº¤æ‚åœ¨ä¸€èµ·çš„é…ç½®ï¼Œæ—¶é—´é•¿äº†è¿é…ç½®æ–‡ä»¶åœ¨å“ªéƒ½æ‰¾ä¸åˆ°äº†ã€‚ç®¡ç†èµ·æ¥æ¯”è¾ƒå¤æ‚ã€‚é‚£äº›æœåŠ¡å™¨çš„ç®¡ç†é¢æ¿å¹¶ä¸æ˜¯å¾ˆå–œæ¬¢ï¼Œè€Œä¸”ç›¸å¯¹äºDockeræ¥è¯´ï¼Œç®¡ç†é¢æ¿åªæ˜¯ç®€åŒ–äº†éƒ¨ç½²çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°æ–¹ä¾¿ç®¡ç†çš„ç›®çš„ã€‚åˆ°æœ€åå¯èƒ½å®ƒçš„è½¯ä»¶ç›®å½•ï¼Œé•œåƒæºéƒ½æ˜¯æŒ‰ç…§å®ƒçš„æƒ³æ³•å»æ”¾çš„ã€‚å¯¹äºè‡ªå·±å¹¶æ²¡æœ‰å®Œå…¨çš„æŒæ§ã€‚å½“ç„¶ä¸èƒ½å®Œå…¨æ‹¿ç®¡ç†é¢æ¿ä¸Dockeræ¥ç›¸æ¯”ï¼ŒäºŒè€…å®Œå…¨æ˜¯ä¸¤ç§æŠ€æœ¯ã€‚åªæ˜¯ç›¸è¾ƒäºæ–¹ä¾¿ç®¡ç†è¿™æ–¹é¢æ¥å¯¹æ¯”ä¸€ä¸‹ã€‚</p><p>è€Œæœ€è¿‘ç ”ç©¶çš„Dockerï¼Œæ— ç–‘æ˜¯æœ€æ»¡æ„çš„äº†ã€‚åœ¨ä¿æŒå®¿ä¸»æœºä¸ä¹±çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å®Œå…¨çš„æŒæ§è‡ªå·±çš„è¿è¡Œç¯å¢ƒã€‚äºæ˜¯å°±æœ‰äº†å°†è‡ªå·±ç›®å‰è·‘äº†æŒºé•¿æ—¶é—´çš„ä¸€å¥—blogç¯å¢ƒéƒ½è¿ç§»åˆ°Dockerä¸Šã€‚å¯¹äºä»¥åè‹¥æ˜¯è¿ç§»æœºå™¨ä¹Ÿä¼šæ›´åŠ çš„æ–¹ä¾¿ã€‚</p><h2 id="æ¶‰åŠåˆ°çš„æ“ä½œ"><a href="#æ¶‰åŠåˆ°çš„æ“ä½œ" class="headerlink" title="æ¶‰åŠåˆ°çš„æ“ä½œ"></a>æ¶‰åŠåˆ°çš„æ“ä½œ</h2><ul><li>Dockerfile</li><li>docker-compose.yml</li><li>apache virtualhost</li><li>php-fpm</li><li>http2</li><li>apache https</li><li>certbot with docker</li><li>apache proxy</li></ul><h2 id="ç›®å‰ç¯å¢ƒ"><a href="#ç›®å‰ç¯å¢ƒ" class="headerlink" title="ç›®å‰ç¯å¢ƒ"></a>ç›®å‰ç¯å¢ƒ</h2><p>å…ˆæ¥ç®€å•çœ‹ä¸‹å½“å‰è·‘åœ¨æœºå™¨ä¸Šçš„ç¯å¢ƒï¼š</p><p>åŸºæœ¬çš„LAMPç¯å¢ƒï¼ŒåŠ ä¸Šä¸€äº›è‡ªå®šä¹‰çš„åº”ç”¨ï¼Œä¸ä¸€ä¸ªæœåŠ¡å™¨ç›‘æ§è½¯ä»¶ã€‚å…¶ä¸­apacheæœ‰å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œå…¨éƒ¨éƒ½ä½¿ç”¨äº†httpsã€‚</p><p>å’‹ä¸€çœ‹æ˜¯ä¸€å¥—å¾ˆç®€å•çš„ç¯å¢ƒï¼Œå…¶ä¸­apacheé…ç½®ç¨å¤šä¸€ç‚¹ã€‚ä½†æ˜¯å®é™…åœ¨è¿ç§»åˆ°Dockerçš„æ“ä½œèµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚å¹¶ä¸”ä¸ºäº†é•œåƒçš„æœ€å°åŒ–ï¼ŒapacheåŸºäºçš„é•œåƒéƒ½æ˜¯alpineã€‚é…ç½®ä¸å¸¸ç”¨çš„Ubuntuç•¥æœ‰ä¸åŒã€‚</p><h2 id="å®¹å™¨åŒ–"><a href="#å®¹å™¨åŒ–" class="headerlink" title="å®¹å™¨åŒ–"></a>å®¹å™¨åŒ–</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>å°†å¤šä¸ªè¿è¡ŒLAMPåˆ†åˆ«æ‹†åˆ†å‡ºä¸‰ä¸ªè¿è¡Œç¯å¢ƒï¼Œä½¿ç”¨docker-composeæ¥æ†ç»‘è¿è¡Œã€‚</p><p>ç›®å½•æ ‘</p><pre><code class="hljs css">.
â”œâ”€â”€ <span class="hljs-selector-tag">apache</span>
â”‚Â Â  â”œâ”€â”€ <span class="hljs-selector-tag">Dockerfile</span>
â”‚Â Â  â”œâ”€â”€ <span class="hljs-selector-tag">httpd</span><span class="hljs-selector-class">.conf</span>
â”‚Â Â  â””â”€â”€ <span class="hljs-selector-tag">sites</span>
â”‚Â Â      â”œâ”€â”€ 000<span class="hljs-selector-tag">-default-ssl</span><span class="hljs-selector-class">.conf</span>
â”‚Â Â      â””â”€â”€ 000<span class="hljs-selector-tag">-default</span><span class="hljs-selector-class">.conf</span>
â”œâ”€â”€ <span class="hljs-selector-tag">docker-compose</span><span class="hljs-selector-class">.yml</span>
â”œâ”€â”€ <span class="hljs-selector-tag">mysql</span>
â”‚Â Â  â””â”€â”€ <span class="hljs-selector-tag">backup</span>
â”œâ”€â”€ <span class="hljs-selector-tag">php</span>
â”‚Â Â  â””â”€â”€ <span class="hljs-selector-tag">Dockerfile</span>
â””â”€â”€ <span class="hljs-selector-tag">www</span>
    â””â”€â”€ <span class="hljs-selector-tag">html</span>
        â””â”€â”€ <span class="hljs-selector-tag">index</span><span class="hljs-selector-class">.php</span></code></pre><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºå­˜æ”¾æ•´ä¸ªè¿è¡Œç¯å¢ƒçš„<code>Docker</code>çˆ¶æ–‡ä»¶å¤¹ã€‚ç„¶åæ ¹æ®ä¸åŒçš„é•œåƒæ¥åˆ’åˆ†ä¸åŒçš„å­æ–‡ä»¶å¤¹ï¼Œå­æ–‡ä»¶å¤¹å†…å­˜æ”¾çš„å°±æ˜¯å„ä¸ªé•œåƒçš„<code>Dockerfile</code>ä¸é…ç½®æ–‡ä»¶ç­‰ã€‚å°†docker-compose.ymlå­˜æ”¾ä¸çˆ¶ç›®å½•ä¸‹ã€‚</p><p>apacheä¸php-fpmé€šä¿¡å€ŸåŠ©Dockerçš„ç½‘ç»œï¼Œå®ç°å†…éƒ¨çš„é€šä¿¡ã€‚</p><h2 id="Apahce"><a href="#Apahce" class="headerlink" title="Apahce"></a>Apahce</h2><p>åœ¨å½“å‰çš„apacheç›®å½•ä¸‹ï¼Œä¸»è¦æ–‡ä»¶å¤¹çš„åˆ’åˆ†ä¸º<code>Dockerfile</code>ã€<code>httpd.conf</code>å’Œsitesæ–‡ä»¶å¤¹ã€‚</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>è™½ç„¶httpdæœ‰äº†ä¸€ä¸ªå•ç‹¬çš„é•œåƒï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ä½¿ç”¨Dockerfileæ¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰é…ç½®ã€‚ä¸ºäº†å°½é‡å‡å°é•œåƒçš„å¤§å°ã€‚è¿™é‡Œä½¿ç”¨åŸºäºalpineçš„apacheã€‚</p><p>åœ¨Docker hubä¸­çš„<a target="_blank" rel="noopener" href="https://hub.docker.com/_/httpd">httpd</a>å½“å‰æ”¯æŒçš„tagï¼š</p><p><img src="../images/Docker%E5%85%A8%E9%9D%A2%E5%AE%B9%E5%99%A8%E5%8C%96/image-20191221185631177.webp" srcset="/images/img/loading.gif" alt="image-20191221185631177"></p><p>æ•´ä¸ªDockerfileï¼š</p><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> httpd:alpine
<span class="hljs-keyword">RUN</span><span class="bash"> sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories \</span>
<span class="bash">	&amp;&amp; apk update \</span>
<span class="bash">        &amp;&amp; apk upgrade</span>
<span class="hljs-keyword">COPY</span><span class="bash"> sites/ /usr/<span class="hljs-built_in">local</span>/apache2/conf/sites/</span>
<span class="hljs-keyword">COPY</span><span class="bash"> httpd.conf /usr/<span class="hljs-built_in">local</span>/apache2/conf/httpd.conf</span></code></pre><p>æ‰€ä»¥<code>FROM</code>é‡Œä½¿ç”¨çš„å°±æ˜¯å¸¦alpineçš„tagäº†ã€‚æˆ‘è¿˜å°è¯•è¿‡æµ‹è¯•ä½¿ç”¨åŸºäºalpineçš„ç©ºè½½è¿è¡Œapacheå¤§æ¦‚èŠ‚çº¦äº†1MBçš„å†…å­˜ã€‚</p><pre><code class="hljs apache"><span class="hljs-attribute">176d166ee52a</span>        testa               <span class="hljs-number">0</span>.<span class="hljs-number">00</span>%             <span class="hljs-number">4</span>.<span class="hljs-number">484</span>MiB / <span class="hljs-number">3</span>.<span class="hljs-number">607</span>GiB   <span class="hljs-number">0</span>.<span class="hljs-number">12</span>%         
<span class="hljs-attribute">3dac39c11385</span>        test                <span class="hljs-number">0</span>.<span class="hljs-number">00</span>%             <span class="hljs-number">5</span>.<span class="hljs-number">664</span>MiB / <span class="hljs-number">3</span>.<span class="hljs-number">607</span>GiB   <span class="hljs-number">0</span>.<span class="hljs-number">15</span>%</code></pre><p>å¯¹äºè·‘åœ¨å›½å†…çš„æœºå™¨ä¸Šï¼Œalpineä¹Ÿæœ‰å›½å†…çš„æºã€‚å¹¶ä¸”æ›¿æ¢çš„ä¹Ÿå¾ˆç®€å•ï¼Œä¸€å¥è¯å°±å¥½äº†ã€‚è¿™æ ·åœ¨åç»­çš„æ›´æ–°æºå’Œå®‰è£…è½¯ä»¶å°±æ²¡æœ‰é‚£ä¹ˆè‹¦æ¼äº†ã€‚</p><pre><code class="hljs gradle">sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> <span class="hljs-regexp">/etc/</span>apk/<span class="hljs-keyword">repositories</span></code></pre><p>å‰©ä¸‹çš„<code>COPY</code>å°±æ˜¯å¤åˆ¶è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶åˆ°å®¹å™¨é‡Œå»äº†ã€‚</p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>é¦–å…ˆï¼Œä¹‹å‰çš„ç¯å¢ƒä¸­apacheæ˜¯æœ‰å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¹¶ä¸”æ¯ä¸ªä¸»æœºéƒ½å¯ç”¨äº†sslä»¥åŠä¸€äº›å…¶ä»–çš„é…ç½®ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯éœ€è¦ä¿®æ”¹å®¹å™¨çš„é…ç½®æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¦å…ˆè·å–é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚</p><p>ä¼˜é›…çš„è·å–apacheé»˜è®¤é…ç½®æ–‡ä»¶ï¼š</p><pre><code class="hljs stata">docker <span class="hljs-keyword">run</span> --<span class="hljs-keyword">rm</span> httpd:2.4 <span class="hljs-keyword">cat</span> /usr/<span class="hljs-keyword">local</span>/apache2/<span class="hljs-keyword">conf</span>/httpd.<span class="hljs-keyword">conf</span> &gt; httpd.<span class="hljs-keyword">conf</span></code></pre><p>é»˜è®¤çš„sslé…ç½®æ–‡ä»¶ï¼š</p><pre><code class="hljs stata">docker <span class="hljs-keyword">run</span> --<span class="hljs-keyword">rm</span> httpd:2.4 <span class="hljs-keyword">cat</span> /usr/<span class="hljs-keyword">local</span>/apache2/<span class="hljs-keyword">conf</span>/extra/httpd-ssl.<span class="hljs-keyword">conf</span> &gt; ssl.<span class="hljs-keyword">conf</span></code></pre><p>å®¹å™¨çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</p><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/apache2/</span>conf/httpd.conf</code></pre><p>è·å–åˆ°äº†é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¹‹åï¼Œåœ¨apacheçš„æ–‡ä»¶å¤¹å†…å¯ä»¥å…ˆè‡ªå®šä¹‰<code>httpd.conf</code>ã€‚å¹¶ä¸”å°è¯•å¯åŠ¨ä¸€æ¬¡ï¼Œæ²¡ç”¨é—®é¢˜åå¯ä»¥ç»§ç»­é…ç½®è™šæ‹Ÿä¸»æœºã€‚</p><p>ç”±äºä¸åŒçš„ç«™ç‚¹éƒ½äº¤ç»™äº†è™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶æ¥å¤„ç†ã€‚æ‰€ä»¥<code>httpd.conf</code>ä¸»è¦æ˜¯è´Ÿè´£ä¸€äº›modçš„é…ç½®ï¼Œå’Œä¸€äº›å…¨å±€çš„é…ç½®äº†ã€‚è¿˜æœ‰å°±æ˜¯å°†ä½™ä¸‹çš„é…ç½®æ–‡ä»¶<code>Include</code>è¿›æ¥äº†ã€‚</p><p>åæœŸè¿˜æœ‰éœ€è¦æ·»åŠ æ›´å¤šçš„è™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œåˆ°æ—¶å€™ä¸€ä¸ªä¸€ä¸ªçš„<code>Include</code>æ“ä½œå¤ªè¿‡ç¹çã€‚æ‰€ä»¥åˆ›å»ºä¸ªä¸“é—¨å­˜æ”¾é…ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå†åœ¨<code>httpd.conf</code>é‡Œå°†æ•´ä¸ªæ–‡ä»¶å¤¹<code>Include</code>è¿›å»ã€‚è¿™æ ·å°±æœ€ç®€å•çš„è§£å†³äº†æ“ä½œç¹ççš„é—®é¢˜ã€‚</p><p>åˆ›å»ºä¸€ä¸ª<code>sites</code>æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œ<code>COPY</code>åˆ°å®¹å™¨å†…ç›¸åº”çš„ç›®å½•ï¼š</p><pre><code class="hljs gradle"><span class="hljs-keyword">COPY</span> sites<span class="hljs-regexp">/ /u</span>sr<span class="hljs-regexp">/local/</span>apache2<span class="hljs-regexp">/conf/</span>sites/</code></pre><p>åœ¨<code>httpd.conf</code>ä¸­ç›¸åº”çš„å¼•å…¥ï¼š</p><pre><code class="hljs gradle"><span class="hljs-keyword">Include</span> <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/apache2/</span>conf<span class="hljs-regexp">/sites/</span>*.conf</code></pre><p>{*}è¿™ä¸€æ“ä½œæ–¹æ³•è¿˜æ˜¯å­¦è‡ªUbuntuä¸‹çš„apacheï¼Œå®ƒçš„é…ç½®ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹<code>sites-available</code>å’Œ<code>sites-enabled</code>ã€‚åœ¨ä¸»è¦çš„apache2.confä¸­å¼•å…¥é…ç½®æ–‡ä»¶ã€‚</p><pre><code class="hljs http"># Include generic snippets of statements
IncludeOptional conf-enabled/*.conf

# Include the virtual host configurations:
IncludeOptional sites-enabled/*.conf</code></pre><p><code>httpd.conf</code>ä¸­çš„è™šæ‹Ÿä¸»æœºé…ç½®ä¸éœ€è¦ä¿®æ”¹äº†ã€‚æ‰€æœ‰çš„ç«™ç‚¹å¯ä»¥éƒ½åœ¨Includeä¸­çš„é…ç½®æ–‡ä»¶ä¸­å‡†å¤‡ã€‚åŸºæœ¬ä¸Š<code>httpd.conf</code>å°±æ˜¯ä¸ºå¼•å…¥é…ç½®æ–‡ä»¶å’Œå¯ç”¨modæ‰€å‡†å¤‡çš„ã€‚</p><h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><p>åœ¨åŸºäºalpineä¸­çš„apacheï¼Œæ‰€æœ‰çš„modåŠ è½½éƒ½å†™åœ¨äº†é…ç½®æ–‡ä»¶<code>httpd.conf</code>é‡Œã€‚åªéœ€è¦å–æ¶ˆæ³¨é‡Šå°±å¯ä»¥åŠ è½½/å¯ç”¨æ¨¡ç»„äº†ã€‚</p><p>è¿™æ¬¡æ·»åŠ çš„moduleï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> deflate_module modules/mod_deflate.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> proxy_module modules/mod_proxy.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> proxy_connect_module modules/mod_proxy_connect.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> proxy_ftp_module modules/mod_proxy_ftp.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> proxy_http_module modules/mod_proxy_http.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> proxy_fcgi_module modules/mod_proxy_fcgi.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> setenvif_module modules/mod_setenvif.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> mpm_event_module modules/mod_mpm_event.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> http<span class="hljs-number">2</span>_module modules/mod_http<span class="hljs-number">2</span>.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> proxy_http<span class="hljs-number">2</span>_module modules/mod_proxy_http<span class="hljs-number">2</span>.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> ssl_module modules/mod_ssl.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> socache_shmcb_module modules/mod_socache_shmcb.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> rewrite_module modules/mod_rewrite.so
<span class="hljs-attribute"><span class="hljs-nomarkup">LoadModule</span></span> headers_module modules/mod_headers.so
<span class="hljs-comment">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span></code></pre><p>è¿™äº›modéƒ½æ˜¯ä½œç”¨äºä½•ï¼Ÿ</p><ul><li><p>mod_deflateæ˜¯ä¸€ä¸ªå‹ç¼©ç®—æ³•ã€‚</p></li><li><p>mod_socache_shmcbå…±äº«å¯¹è±¡ç¼“å­˜æä¾›ç¨‹åºã€‚</p></li><li><p>å› ä¸ºéœ€è¦é…ç½®åä»£å’Œä¸php-fpmå·¥ä½œï¼Œæ‰€ä»¥éœ€è¦å¯ç”¨å¤šä¸ªproxyé…ç½®æ–‡ä»¶ã€‚</p></li><li><p>å› ä¸ºéœ€è¦ç”¨åˆ°http2ï¼Œæ‰€ä»¥å·¥ä½œæ¨¡å¼å¾—ä¿®æ”¹ä¸ºeventã€‚åŒæ—¶æ³¨é‡Šæ‰é»˜è®¤çš„å·¥ä½œæ¨¡å¼preforkã€‚è‡ªç„¶ä¹Ÿéœ€è¦mod_http2</p></li><li><p>httpsæ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼Œæ‰€ä»¥mod_sslä¸å¯ç¼ºå°‘ã€‚</p></li><li><p>åç»­çš„åšå®¢éœ€è¦ç”¨åˆ°ä¼ªé™æ€ï¼Œmod_rewriteä¹Ÿä¸å¯å°‘ã€‚</p></li><li><p>åœ¨æœ€è¿‘ä¹Ÿæ·»åŠ äº†å¤šä¸ªheaderå¤´ï¼Œéœ€è¦ç”¨åˆ°mod_headersã€‚</p></li></ul><blockquote><p>infoï¼šæ ¹æ®è‡ªå·±éœ€è¦å¯ç”¨moduleæ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ï¼Œè¿‡å¤šçš„moduleä¼šå½±å“æ€§èƒ½ã€‚</p></blockquote><h3 id="è™šæ‹Ÿä¸»æœº"><a href="#è™šæ‹Ÿä¸»æœº" class="headerlink" title="è™šæ‹Ÿä¸»æœº"></a>è™šæ‹Ÿä¸»æœº</h3><p>å‰é¢æåˆ°ï¼Œä¸“é—¨åˆ›å»ºäº†ä¸€ä¸ªsitesæ–‡ä»¶å¤¹æ¥å­˜æ”¾è™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œç›®å‰sitesæ–‡ä»¶å¤¹è¿˜æ˜¯ç©ºçš„ã€‚æ—¢ç„¶<code>httpd.conf</code>ä»¥åŠå‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å¡«æ»¡sitesæ–‡ä»¶å¤¹äº†ã€‚</p><p>åœ¨è¿˜æœªæ·»åŠ è™šæ‹Ÿä¸»æœºæ—¶ï¼Œé»˜è®¤çš„ç«™ç‚¹é…ç½®æ–‡ä»¶å…¨éƒ¨éƒ½å†™åœ¨<code>httpd.conf</code>é‡Œã€‚é»˜è®¤çš„æ ¹ç›®å½•åœ¨htdocsã€‚æ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æµ‹è¯•æ—¶ï¼Œè®¿é—®çš„æ—¶è¿™é‡Œçš„htmlæ–‡ä»¶ã€‚</p><pre><code class="hljs apache"><span class="hljs-attribute"><span class="hljs-nomarkup">DocumentRoot</span></span> <span class="hljs-string">&quot;/usr/local/apache2/htdocs&quot;</span></code></pre><p>è¿™é‡Œçš„é…ç½®å¯ä»¥ä¸ç”¨åŠ¨ï¼Œå…¨éƒ¨æ“ä½œäº¤ç»™è™šæ‹Ÿä¸»æœºå°±å¥½ã€‚</p><p>æ•´ä¸ªè™šæ‹Ÿä¸»æœºï¼ˆdefault.confï¼‰é…ç½®æ–‡ä»¶ï¼š</p><pre><code class="hljs apache"><span class="hljs-section">&lt;VirtualHost *<span class="hljs-number">:80</span>&gt;</span>
<span class="hljs-attribute">ProtocolsHonorOrder</span> <span class="hljs-literal">On</span>
<span class="hljs-attribute">Protocols</span> h<span class="hljs-number">2</span> h<span class="hljs-number">2</span>c
<span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> set X-Frame-Options <span class="hljs-string">&quot;SAMEORIGIN&quot;</span>
<span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> always set Strict-Transport-Security <span class="hljs-string">&quot;max-age=63072000; includeSubdomains;&quot;</span>
<span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> set Content-Security-Policy <span class="hljs-string">&quot;default-src &#x27;self&#x27; https://cdn.defectink.com; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27; https://maxcdn.bootstrapcdn.com https://ajax.googleapis.com https://cdn.defectink.com; img-src *; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; https://cdn.defectink.com https://maxcdn.bootstrapcdn.com https://fonts.googleapis.com/; font-src &#x27;self&#x27; https://cdn.defectink.com https://fonts.gstatic.com/ https://maxcdn.bootstrapcdn.com; form-action &#x27;self&#x27; https://cdn.defectink.com; upgrade-insecure-requests;&quot;</span>
<span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> set X-Content-Type-Options nosniff
<span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> always set Referrer-Policy <span class="hljs-string">&quot;no-referrer-when-downgrade&quot;</span>
<span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> always set Feature-Policy <span class="hljs-string">&quot;vibrate &#x27;self&#x27;; sync-xhr &#x27;self&#x27; https://cdn.defectink.com https://www.defectink.com&quot;</span>
    <span class="hljs-comment"># Proxy .php requests to port 9000 of the php-fpm container</span>
    <span class="hljs-attribute">ProxyPassMatch</span> ^/(.*\.php(/.*)?)$ fcgi://php:<span class="hljs-number">9000</span>/var/www/html/$<span class="hljs-number">1</span>
    <span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span> www.defectink.com
    <span class="hljs-attribute"><span class="hljs-nomarkup">DocumentRoot</span></span> /var/www/html/
    <span class="hljs-section">&lt;Directory /var/www/html/&gt;</span>
        <span class="hljs-attribute">DirectoryIndex</span> index.php
        <span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span> Indexes FollowSymLinks
        <span class="hljs-attribute">AllowOverride</span> <span class="hljs-literal">All</span>
        <span class="hljs-attribute">Require</span> <span class="hljs-literal">all</span> granted
    <span class="hljs-section">&lt;/Directory&gt;</span>
    <span class="hljs-comment"># Send apache logs to stdout and stderr</span>
    <span class="hljs-attribute">CustomLog</span> /proc/self/fd/<span class="hljs-number">1</span> common
    <span class="hljs-attribute">ErrorLog</span> /proc/self/fd/<span class="hljs-number">2</span>
<span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span> <span class="hljs-literal">on</span>
<span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;SERVER_NAME&#125;</span> =www.defectink.com
<span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span> ^ https://<span class="hljs-variable">%&#123;SERVER_NAME&#125;</span><span class="hljs-variable">%&#123;REQUEST_URI&#125;</span><span class="hljs-meta"> [END,NE,R=permanent]</span>
<span class="hljs-section">&lt;/VirtualHost&gt;</span></code></pre><h4 id="è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§"><a href="#è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§" class="headerlink" title="è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§"></a>è™šæ‹Ÿä¸»æœºä¼˜å…ˆçº§</h4><p>åœ¨apacheä¸­ï¼Œè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶æ˜¯æ‹¥æœ‰ä¼˜å…ˆçº§çš„ã€‚ä¼˜å…ˆçº§çš„æ„æ€å°±æ˜¯ï¼Œå½“ä¸€ä¸ªåŸŸåæŒ‡å‘å½“å‰æœºå™¨çš„ipï¼Œè€Œé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰ç»‘å®šçš„ServerNameæ—¶ï¼Œé»˜è®¤è¢«å¼•å¯¼åˆ°çš„é¡µé¢ã€‚</p><p>ä¼˜å…ˆçº§çš„é¡ºåºæ˜¯æ ¹æ®è™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶åæ¥å†³å®šçš„ã€‚åç§°é¦–å­—æ¯è¶Šé å‰ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä½¿ç”¨æ•°å­—å¼€å¤´å°†å¤§äºå­æ¯å¼€å¤´ã€‚</p><blockquote><p>000-default will be the default, because it goes â€œnumbers, then lettersâ€.</p></blockquote><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„é»˜è®¤ç«™ç‚¹ï¼š</p><pre><code class="hljs bash">httpd -S</code></pre><pre><code class="hljs bash">apache2ctl -S</code></pre><h3 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h3><p>è¿™é‡Œçš„sslé…ç½®æ–‡ä»¶æ˜¯æ¥è‡ªäºå®¹å™¨å†…çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ä¸Šè¿°çš„æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¼å‡ºã€‚</p><p>æ•´ä¸ªsslï¼ˆdefault-ssl.confï¼‰é…ç½®æ–‡ä»¶ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">Listen</span> <span class="hljs-number">443</span>

SSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!<span class="hljs-number">3</span>DES
SSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!<span class="hljs-number">3</span>DES
SSLHonorCipherOrder <span class="hljs-keyword">on</span> 
SSLProtocol <span class="hljs-keyword">all</span> -SSLv3
SSLProxyProtocol <span class="hljs-keyword">all</span> -SSLv3
SSLPassPhraseDialog  builtin
SSLSessionCache        &quot;shmcb:/usr/local/apache2/logs/ssl_scache(512000)&quot;
SSLSessionCacheTimeout  <span class="hljs-number">300</span>

&lt;VirtualHost *:<span class="hljs-number">443</span>&gt;
ProtocolsHonorOrder <span class="hljs-keyword">On</span>
Protocols h2 h2c
<span class="hljs-keyword">Header</span> <span class="hljs-keyword">set</span> X-Frame-<span class="hljs-keyword">Options</span> &quot;SAMEORIGIN&quot;
<span class="hljs-keyword">Header</span> <span class="hljs-keyword">always</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">Strict</span>-Transport-<span class="hljs-keyword">Security</span> &quot;max-age=63072000; includeSubdomains;&quot;
<span class="hljs-keyword">Header</span> <span class="hljs-keyword">set</span> Content-<span class="hljs-keyword">Security</span>-<span class="hljs-keyword">Policy</span> &quot;default-src &#x27;self&#x27; https://cdn.defectink.com; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27; https://maxcdn.bootstrapcdn.com https://ajax.googleapis.com https://cdn.defectink.com; img-src *; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; https://cdn.defectink.com https://maxcdn.bootstrapcdn.com https://fonts.googleapis.com/; font-src &#x27;self&#x27; https://cdn.defectink.com https://fonts.gstatic.com/ https://maxcdn.bootstrapcdn.com; form-action &#x27;self&#x27; https://cdn.defectink.com; upgrade-insecure-requests;&quot;
<span class="hljs-keyword">Header</span> <span class="hljs-keyword">set</span> X-Content-<span class="hljs-keyword">Type</span>-<span class="hljs-keyword">Options</span> nosniff
<span class="hljs-keyword">Header</span> <span class="hljs-keyword">always</span> <span class="hljs-keyword">set</span> Referrer-<span class="hljs-keyword">Policy</span> &quot;no-referrer-when-downgrade&quot;
<span class="hljs-keyword">Header</span> <span class="hljs-keyword">always</span> <span class="hljs-keyword">set</span> Feature-<span class="hljs-keyword">Policy</span> &quot;vibrate &#x27;self&#x27;; sync-xhr &#x27;self&#x27; https://cdn.defectink.com https://www.defectink.com&quot;
# Proxy .php requests <span class="hljs-keyword">to</span> port <span class="hljs-number">9000</span> <span class="hljs-keyword">of</span> the php-fpm container
ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://php:<span class="hljs-number">9000</span>/var/www/html/<span class="hljs-meta">$1</span>
# General setup <span class="hljs-keyword">for</span> the virtual host
DocumentRoot &quot;/var/www/html/&quot;
ServerName www.defectink.com:<span class="hljs-number">443</span>
ServerAdmin i@defect.ink
    &lt;Directory /var/www/html/&gt;
        DirectoryIndex <span class="hljs-keyword">index</span>.php
        <span class="hljs-keyword">Options</span> Indexes FollowSymLinks
        AllowOverride <span class="hljs-keyword">All</span>
        Require <span class="hljs-keyword">all</span> granted
    &lt;/Directory&gt;
ErrorLog /proc/self/fd/<span class="hljs-number">2</span>
TransferLog /proc/self/fd/<span class="hljs-number">1</span>

SSLEngine <span class="hljs-keyword">on</span>
SSLCertificateFile &quot;/etc/letsencrypt/live/www.defectink.com/fullchain.pem&quot;
SSLCertificateKeyFile &quot;/etc/letsencrypt/live/www.defectink.com/privkey.pem&quot;
&lt;FilesMatch &quot;\.(cgi|shtml|phtml|php)$&quot;&gt;
    SSLOptions +StdEnvVars
&lt;/FilesMatch&gt;
&lt;Directory &quot;/usr/local/apache2/cgi-bin&quot;&gt;
    SSLOptions +StdEnvVars
&lt;/Directory&gt;
BrowserMatch &quot;MSIE [2-5]&quot; \
         nokeepalive ssl-unclean-shutdown \
         downgrade<span class="hljs-number">-1.0</span> force-response<span class="hljs-number">-1.0</span>
CustomLog /proc/self/fd/<span class="hljs-number">1</span> \
          &quot;%t %h %&#123;SSL_PROTOCOL&#125;x %&#123;SSL_CIPHER&#125;x \&quot;%r\&quot; %b&quot;

&lt;/VirtualHost&gt;</code></pre><p>è¿™é‡Œçš„ä¸»è¦é…ç½®ç‚¹å°±åœ¨<code>SSLCertificateFile</code>å’Œ<code>SSLCertificateKeyFile</code>ã€‚å…³äºé…åˆcertbotç”³è¯·è¯ä¹¦ï¼Œåœ¨å‰ä¸€ç¯‡æ°´è¿‡ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»äº†è§£æ›´å¤šã€‚<a href="https://www.defectink.com/defect/docker-build-own-images.html#menu_index_8">Docker - æ„å»ºå±äºè‡ªå·±çš„é•œåƒ</a>ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€ä¸ª<code>httpd.conf</code>æ–‡ä»¶ä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>Listen 443</code>å­—æ®µã€‚è€Œé»˜è®¤çš„sslé…ç½®æ–‡ä»¶ä¸­å°±åŒ…å«ä¸€ä¸ª<code>Listen 443</code>å­—æ®µã€‚å½“å¤åˆ¶å¤šä¸ªé»˜è®¤çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œä¼šå¯¼è‡´apacheè¿è¡Œé”™è¯¯ã€‚å› ä¸ºæ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½ä¼šè¢«å¼•å…¥åˆ°<code>httpd.conf</code>ï¼Œè€Œä¸€ä¸ªapacheåªèƒ½ç›‘å¬ä¸€æ¬¡ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½æœ‰ä¸€ä¸ª<code>Listen 443</code>åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>å¯ä»¥è€ƒè™‘å°†å…¶å†™åœ¨ç›‘å¬80ç«¯å£ä¸‹é¢ï¼š</p><pre><code class="hljs angelscript">#Listen <span class="hljs-number">12.34</span><span class="hljs-number">.56</span><span class="hljs-number">.78</span>:<span class="hljs-number">80</span>
Listen <span class="hljs-number">80</span>
Listen <span class="hljs-number">443</span></code></pre><h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><p>è¿™é‡Œè™šæ‹Ÿä¸»æœºçš„é»˜è®¤é…ç½®æ—¶å°†æ—¥å¿—å‘é€åˆ°stdoutå’Œstderrã€‚å¯ä»¥ç†è§£ä¸ºè¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚</p><pre><code class="hljs awk"><span class="hljs-comment"># Send apache logs to stdout and stderr</span>
CustomLog <span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/fd/</span><span class="hljs-number">1</span> common
ErrorLog <span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/fd/</span><span class="hljs-number">2</span></code></pre><p>å½“ç„¶ä¹Ÿå¯ä»¥å®ç°æ—¥å¿—çš„æŒä¹…åŒ–ä¿å­˜ã€‚å°†å…¶æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç›®å½•ä¸‹å°±å¥½äº†ã€‚</p><pre><code class="hljs maxima">CustomLog /<span class="hljs-built_in">var</span>/<span class="hljs-built_in">log</span>/access.<span class="hljs-built_in">log</span> common
ErrorLog /<span class="hljs-built_in">var</span>/<span class="hljs-built_in">log</span>/<span class="hljs-built_in">error</span>.<span class="hljs-built_in">log</span></code></pre><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>PHPè¿™é‡Œä½¿ç”¨fpmï¼Œé…åˆdocker-composeçš„å†…éƒ¨ç½‘ç»œä¸apacheè¿›è¡Œé€šä¿¡ã€‚</p><h3 id="Dockerfile-1"><a href="#Dockerfile-1" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> php:7.4-fpm-alpine
<span class="hljs-builtin-name">RUN</span> mv <span class="hljs-string">&quot;<span class="hljs-variable">$PHP_INI_DIR</span>/php.ini-production&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PHP_INI_DIR</span>/php.ini&quot;</span>
COPY php.ini <span class="hljs-variable">$PHP_INI_DIR</span>/conf.d/
<span class="hljs-builtin-name">RUN</span> sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories \
        &amp;&amp; apk update \
        &amp;&amp; apk<span class="hljs-built_in"> upgrade </span>\
        &amp;&amp; docker-php-ext-install mysqli \
        &amp;&amp; docker-php-ext-install pdo_mysql</code></pre><h3 id="php-ini"><a href="#php-ini" class="headerlink" title="php.ini"></a>php.ini</h3><p>ä¼˜é›…çš„è·å–å®¹å™¨å†…çš„php.iniæ–‡ä»¶ï¼š</p><pre><code class="hljs awk">docker cp somephp:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/etc/</span>php<span class="hljs-regexp">/ /</span>root</code></pre><p>ä¿®æ”¹è¿‡åçš„é…ç½®æ–‡ä»¶å¯ä»¥åœ¨Dockerfileä¸­copyï¼Œä¹Ÿå¯ä»¥åœ¨compose.ymlä¸­æ˜ å°„ã€‚åªè¦åˆ°äº†å®¿ä¸»æœºçš„æ­£ç¡®ä½ç½®å°±å¯ä»¥ç”Ÿæ•ˆã€‚</p><p>å®˜æ–¹çš„æè¿°æ˜¯è¿™æ ·çš„æ–¹æ³•ï¼š</p><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="bash"> mv <span class="hljs-string">&quot;<span class="hljs-variable">$PHP_INI_DIR</span>/php.ini-production&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PHP_INI_DIR</span>/php.ini&quot;</span></span>
<span class="hljs-keyword">COPY</span><span class="bash"> php.ini <span class="hljs-variable">$PHP_INI_DIR</span>/conf.d/</span></code></pre><h3 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h3><p>å¦‚æœéœ€è¦å®‰è£…typechoè¿™æ ·çš„blogç¨‹åºçš„è¯ï¼Œå†è¿æ¥sqlæ—¶éœ€è¦å®‰è£…mysqlçš„æ‹“å±•ï¼Œå†™åœ¨Dockerfileå°±å¥½äº†ï¼š</p><pre><code class="hljs cmake">docker-php-ext-<span class="hljs-keyword">install</span> pdo_mysql</code></pre><p>å¦‚æœè¿˜éœ€è¦å…¶ä»–çš„æ‹“å±•çš„è¯ï¼Œè¿˜å¯ä»¥åœ¨Dockerfileé‡Œè‡ªå®šä¹‰å®‰è£…ã€‚å¯ä»¥ä½¿ç”¨<code>pecl</code>æ¥å®‰è£…ï¼Œç„¶åä½¿ç”¨<code>docker-php-ext-enable</code>æ¥å¯ç”¨å®ƒã€‚</p><blockquote><p>use <code>pecl install</code> to download and compile it, then use <code>docker-php-ext-enable</code> to enable it:</p></blockquote><pre><code class="hljs angelscript">FROM php:<span class="hljs-number">7.4</span>-cli
RUN pecl install redis<span class="hljs-number">-5.1</span><span class="hljs-number">.1</span> \
    &amp;&amp; pecl install xdebug<span class="hljs-number">-2.8</span><span class="hljs-number">.1</span> \
    &amp;&amp; docker-php-ext-enable redis xdebug</code></pre><p>æˆ–è€…ç›´æ¥ä½¿ç”¨<code>docker-php-ext-install</code>æ¥å®‰è£…ï¼š</p><pre><code>    &amp;&amp; docker-php-ext-install mysqli \
    &amp;&amp; docker-php-ext-install pdo_mysql</code></pre><p>è‡³äºæ›´å¤šçš„æ‹“å±•ï¼Œè¿˜å¯ä»¥ç¼–è¯‘å®‰è£…ï¼š</p><pre><code class="hljs livescript">FROM php:<span class="hljs-number">5.6</span>-cli
RUN curl -fsSL <span class="hljs-string">&#x27;https://xcache.lighttpd.net/pub/Releases/3.2.0/xcache-3.2.0.tar.gz&#x27;</span> -o xcache.tar.gz <span class="hljs-string">\</span>
    &amp;&amp; mkdir -p xcache <span class="hljs-string">\</span>
    &amp;&amp; tar -xf xcache.tar.gz -C xcache --strip-components=<span class="hljs-number">1</span> <span class="hljs-string">\</span>
    &amp;&amp; rm xcache.tar.gz <span class="hljs-string">\</span>
    &amp;&amp; ( <span class="hljs-string">\</span>
        cd xcache <span class="hljs-string">\</span>
        &amp;&amp; phpize <span class="hljs-string">\</span>
        &amp;&amp; ./configure --enable-xcache <span class="hljs-string">\</span>
        &amp;&amp; make -j <span class="hljs-string">&quot;$(nproc)&quot;</span> <span class="hljs-string">\</span>
        &amp;&amp; make install <span class="hljs-string">\</span>
    ) <span class="hljs-string">\</span>
    &amp;&amp; rm -r xcache <span class="hljs-string">\</span>
    &amp;&amp; docker-php-ext-enable xcache</code></pre><h2 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h2><p>mysqlä¸»è¦ä¿®æ”¹çš„ä¸€äº›é…ç½®ä½¿ç”¨å¯åŠ¨æ—¶çš„ç¯å¢ƒå˜é‡å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¾¿ç”¨ä¸åˆ°Dockerfileäº†ã€‚ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„é•œåƒå°±å¥½äº†ã€‚</p><h3 id="Docker-Secrets"><a href="#Docker-Secrets" class="headerlink" title="Docker Secrets"></a>Docker Secrets</h3><p>å¦‚æœæ‹…å¿ƒå¯†ç å†™åœ¨docker-compose.ymlé‡Œä¸å®‰å…¨çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨docker secretã€‚ä¸è¿‡secretéœ€è¦ä½¿ç”¨swarmé›†ç¾¤ã€‚å•å°ä¸»æœºåªä½¿ç”¨docker-composeå¯èƒ½ä¼šæ›´åŠ æ–¹ä¾¿ä¸€ç‚¹ã€‚</p><p>å¹¶ä¸”åœ¨composeä¸­ç”Ÿæˆçš„æ˜¯ä¸¤ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œåªæœ‰apacheåœ¨å‰ç«¯ç½‘ç»œæ˜ å°„äº†ç«¯å£ã€‚mysqlå®Œå…¨æ”¾åœ¨åç«¯ï¼Œé™¤äº†è™šæ‹Ÿç½‘ç»œå’Œå®¿ä¸»æœºéƒ½æ— æ³•ä¸å…¶é€šä¿¡ã€‚æ‰€ä»¥å¯†ç çš„å®‰å…¨å¹¶ä¸ç”¨å¤ªè¿‡äºæ‹…å¿ƒã€‚å¦‚æœmysqléœ€è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œé‚£å°±éœ€è¦å¤šæ‹…å¿ƒä¸€ä¸‹äº†ã€‚</p><pre><code class="hljs routeros">$ docker <span class="hljs-builtin-name">run</span> --name some-mysql -e <span class="hljs-attribute">MYSQL_ROOT_PASSWORD_FILE</span>=/run/secrets/mysql-root -d mysql:tag</code></pre><blockquote><p>æ˜ å°„äº†ç›®å½•åï¼Œé…ç½®çš„å¯†ç éƒ½ä¼šè¢«æŒä¹…åŒ–ä¿å­˜ã€‚å†æ¬¡ä¿®æ”¹docker-compose.ymlä¸­çš„å˜é‡å°†ä¸ä¼šç”Ÿæ•ˆã€‚</p></blockquote><h3 id="æ•°æ®æŒä¹…åŒ–"><a href="#æ•°æ®æŒä¹…åŒ–" class="headerlink" title="æ•°æ®æŒä¹…åŒ–"></a>æ•°æ®æŒä¹…åŒ–</h3><p>å¯¹äºdockeræ¥è¯´ï¼Œå°½é‡ä¸è¦åœ¨å®¹å™¨å†…å‘ç”Ÿå†™çš„æ“ä½œä¸ºå¥½ã€‚æ­¤å¤–ï¼Œå¯¹äºæ•°æ®åº“æ¥ï¼Œæ•°æ®è‚¯å®šæ˜¯éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„ã€‚å®˜æ–¹æ¨èçš„æ˜¯ï¼š</p><blockquote><p>Important note: There are several ways to store data used by applications that run in Docker containers. We encourage users of the <code>mysql</code> images to familiarize themselves with the options available, including:</p><ul><li>Let Docker manage the storage of your database data <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/tutorials/dockervolumes/#adding-a-data-volume">by writing the database files to disk on the host system using its own internal volume management</a>. This is the default and is easy and fairly transparent to the user. The downside is that the files may be hard to locate for tools and applications that run directly on the host system, i.e. outside containers.</li><li>Create a data directory on the host system (outside the container) and <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-directory-as-a-data-volume">mount this to a directory visible from inside the container</a>. This places the database files in a known location on the host system, and makes it easy for tools and applications on the host system to access the files. The downside is that the user needs to make sure that the directory exists, and that e.g. directory permissions and other security mechanisms on the host system are set up correctly.</li></ul></blockquote><p>è¯´ç™½äº†å°±æ˜¯æ˜ å°„å‡ºæ¥ä¸ºæœ€ä½³è§£å†³æ–¹æ¡ˆã€‚å¦‚æœåœ¨compose.ymlä¸­ä½¿ç”¨<code>-v</code>æ˜ å°„ï¼Œè€Œä¸æ·»åŠ å®¿ä¸»æœºçš„ç›®å½•ä½ç½®çš„è¯ã€‚æ–‡ä»¶å°†ä¼šè¢«æ˜ å°„åˆ°ä¸€ä¸ªéšæœºçš„ç›®å½•ã€‚</p><p>æ¨èæ–¹æ¡ˆï¼š</p><pre><code class="hljs awk">$ docker run --name some-mysql -v <span class="hljs-regexp">/my/</span>own<span class="hljs-regexp">/datadir:/</span>var<span class="hljs-regexp">/lib/my</span>sql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</code></pre><h3 id="å¤‡ä»½ä¸æ¢å¤"><a href="#å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="å¤‡ä»½ä¸æ¢å¤"></a>å¤‡ä»½ä¸æ¢å¤</h3><p>é’ˆå¯¹å•ä¸ªæˆ–å¤šä¸ªæ•°æ®åº“éƒ½å¯ä»¥å¯¼å‡ºä¸ºsqlæ–‡ä»¶ã€‚åœ¨dockerä¸­å½“ç„¶ä¹Ÿæ˜¯åŒæ ·ã€‚ç”šè‡³å¯†ç å¯ä»¥ä½¿ç”¨å˜é‡<code>$MYSQL_ROOT_PASSWORD</code>æ¥ä»£æ›¿ã€‚</p><p>å¯¼å…¥ï¼š</p><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -i mysql sh -c <span class="hljs-string">&#x27;exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot; typecho&#x27;</span> &lt; /data/docker/typecho.sql</code></pre><p>å¯¼å‡ºï¼š</p><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> mysql sh -c <span class="hljs-string">&#x27;exec mysqldump typecho -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27;</span> &gt; /data/docker/mysql/backup/typecho.sql</code></pre><h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><p>æ•´ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><p>docker-compose.yml</p><pre><code class="hljs dockerfile">version: <span class="hljs-string">&quot;3.2&quot;</span>
services:
  php:
    container_name: php
    build: <span class="hljs-string">&#x27;./php/&#x27;</span>
    networks:
      - backend
    volumes:
      - ./www/:/var/www/
  apache:
    container_name: apache
    build: <span class="hljs-string">&#x27;./apache/&#x27;</span>
    depends_on:
      - php
      - mysql
    networks:
      - frontend
      - backend
    ports:
      - <span class="hljs-string">&quot;80:80&quot;</span>
      - <span class="hljs-string">&quot;443:443&quot;</span>
    volumes:
      - ./www/:/var/www/
      - /etc/letsencrypt/:/etc/letsencrypt/
      - ./apache/logs/:/var/log/
  mysql:
    container_name: mysql
    image: mysql:<span class="hljs-number">5.7</span>
    volumes:
      - ./mysql/sqldata/:/var/lib/mysql
    networks:
      - backend
    environment:
      - MYSQL_ROOT_PASSWORD=password
    command: [<span class="hljs-string">&#x27;mysqld&#x27;</span>, <span class="hljs-string">&#x27;--character-set-server=utf8mb4&#x27;</span>]
  bark: 
    container_name: bark
    build: <span class="hljs-string">&#x27;./bark&#x27;</span>
    ports: 
      - <span class="hljs-string">&quot;8181&quot;</span>
    depends_on:
      - apache
    networks:
      - backend
networks:
  frontend:
  backend:</code></pre><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><pre><code class="hljs applescript">It <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> belong <span class="hljs-keyword">to</span> any <span class="hljs-keyword">of</span> this network&#x27;s subnets</code></pre><p>è¿™ä¸ªé—®é¢˜å¾ˆæœ‰æ„æ€ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº†ç½‘ç»œæ®µã€‚ä¹Ÿåœ¨æœåŠ¡ä¸‹å†™äº†ç›¸åŒçš„åœ°å€æ®µï¼Œå®ƒä¾ç„¶è¯´æˆ‘çš„ç½‘æ®µä¸ä¸€æ ·ã€‚</p><p>å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯åœ¨è‡ªå®šä¹‰é…ç½®ç½‘æ®µä¹‹å‰å¯åŠ¨è¿‡ç›¸åŒçš„ç½‘ç»œï¼Œåœ¨dockerç½‘ç»œä¸‹å®ƒå·²ç»å®šä¹‰è¿‡ç½‘æ®µäº†ã€‚å†æ¬¡é‡æ–°æ‰‹åŠ¨æŒ‡å®šç½‘ç»œåœ°å€æ—¶ï¼Œä¼šå’Œä¹‹å‰çš„ä¸ä¸€æ ·ã€‚</p><p>åªéœ€è¦åˆ é™¤ä¹‹å‰çš„ç½‘ç»œï¼Œåœ¨é‡æ–°è¿è¡Œ<code>docker-sompose up</code>ä¸€éå°±å¯ä»¥äº†ã€‚</p><p>æŸ¥çœ‹ç½‘ç»œï¼š</p><pre><code class="hljs bash">docker network ls</code></pre><p>åˆ é™¤ï¼š</p><pre><code class="hljs bash">docker network rm docker_backend</code></pre><h3 id="æ­¤å¤–"><a href="#æ­¤å¤–" class="headerlink" title="æ­¤å¤–"></a>æ­¤å¤–</h3><pre><code class="hljs yaml">  <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>
<span class="hljs-attr">ipv4_address:</span> <span class="hljs-number">172.18</span><span class="hljs-number">.0</span><span class="hljs-number">.10</span></code></pre><p>ä¸åŒçš„è¯­æ³•å†™åœ¨ä¸€èµ·ä¹Ÿä¼šå¯¼è‡´é”™è¯¯ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/questions/how-to-set-the-default-virtual-host-on-apache-2">How to set the default virtual host on Apache 2?</a></li><li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45648821/docker-compose-up-error-invalid-address">docker-compose up error, Invalid address</a></li><li><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/networking/">Networking in Compose</a></li><li><a target="_blank" rel="noopener" href="https://www.cloudreach.com/en/insights/blog/containerize-this-how-to-use-php-apache-mysql-within-docker-containers/">Containerize This! How to use PHP, Apache, MySQL within Docker containers</a></li></ul><pre><code class="hljs awk">docker run -it --rm --name certbot \
   -v <span class="hljs-string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \
   -v <span class="hljs-string">&quot;/var/lib/letsencrypt:/var/lib/letsencrypt&quot;</span> \
   -v <span class="hljs-string">&quot;/data/docker/web/www/:/data/docker/web/www/&quot;</span> \
   certbot/certbot certonly -n --webroot \
   -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/test -d test.defectink.com \
   -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/html -d www.defectink.com \
   -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/index -d index.defectink.com \
   -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/api -d api.defectink.com</code></pre><pre><code class="hljs angelscript">docker run --rm --name myadmin -d --network docker_backend --link mysql_db_server:mysql -e PMA_HOST=<span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span> -p <span class="hljs-number">3002</span>:<span class="hljs-number">80</span> phpmyadmin/phpmyadmin</code></pre><pre><code class="hljs awk">certbot certonly -n --webroot -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/html -d www.defectink.com --post-hook <span class="hljs-string">&quot;docker restart apache&quot;</span></code></pre><pre><code class="hljs awk">certbot certonly -n --webroot -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/html -d www.defectink.com
certbot certonly -n --webroot -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/index -d index.defectink.com
certbot certonly -n --webroot -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/test -d test.defectink.com
certbot certonly -n --webroot -w <span class="hljs-regexp">/data/</span>docker<span class="hljs-regexp">/web/</span>www/api -d api.defectink.com</code></pre></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E5%AE%9E%E8%B7%B5/">å®è·µ</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/Linux/">Linux</a></div></div><p class="note note-warning"><a target="_blank" href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener noopener">CC BY-SA 3.0â¤</a></p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/defect/javascript-notes-reference-type.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">JavaScriptç¬”è®°-å¼•ç”¨ç±»å‹</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/defect/header-practice-have-to-win-this-a.html"><span class="hidden-mobile">Headerå®è·µ-å¾—æ‹¿ä¸‹è¿™ä¸ªA</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span><i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">function loadValine(){addScript("https://cdn.defectink.com/static/valine/1.4.14/Valine.min.js",function(){new Valine({el:"#vcomments",app_id:"dD9t7mcIBVzJWag5ez6GPy2v-MdYXbMMI",app_key:"bWG6pmKsEscrH4JjrpNNAAy6",placeholder:"å˜¤å˜¤å˜¤ï¼Ÿï¼Ÿï¼Ÿ",path:window.location.pathname,avatar:"retro",meta:["nick","mail","link"],pageSize:"10",lang:"zh-CN",highlight:!0,recordIP:!1,serverURLs:""})})}waitElementVisible("vcomments",loadValine)</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a><i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="beian"><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">çš–ICPå¤‡17017808å·</a></div></footer><script src="https://cdn.defectink.com/static/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.defectink.com/static/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer="defer" src="https://cdn.defectink.com/static/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script src="/js/xfy.js"></script><script src="https://cdn.defectink.com/static/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://cdn.defectink.com/static/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Docker-å…¨é¢å®¹å™¨åŒ–ï¼&nbsp;"],cursorChar:"â¤",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="/js/local-search.js"></script><script>var path="/xml/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.defectink.com/static/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.defectink.com/static/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script src="https://cdn.defectink.com/static/mermaid/8.5.0/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"default"})</script></body></html>